// Module included in the following assemblies:
//
// * service-mesh-docs-main/about/ossm-migrating-migration-guides-assembly.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-migrating-multitenant-with-cert-manager_{context}"]
== Migrating a multitenant deployment with the cert-manager tool

If you are running a multitenant deployment with the cert-manager tool, you need to perform the following steps to configure the cert-manager tool for {SMProductName} 3 before you can migrate your deployment.

.Prerequisites

* You have deployed a cluster on {ocp-product-title} 4.14 or later.
* You are logged in to the {ocp-product-title} web console as a user with the cluster-admin role.
* You have completed the premigration checklists.
* You have {SMProduct} {SMv2Version} Operator installed.
* You have {SMProduct} 3 Operator installed.
* You are running a cluster-wide deployment.
* Your `ServiceMeshControlPlane` is configured with the cert-manager tool:
+
.`ServiceMeshControlPlane` cert-manager configuration
[source,yaml]
----
apiVersion: maistra.io/v2
kind: ServiceMeshControlPlane
metadata:
  name: basic
  namespace: istio-system
spec:
  ...
  security:
    certificateAuthority:
      cert-manager:
        address: cert-manager-istio-csr.istio-system.svc:443
      type: cert-manager
    dataPlane:
      mtls: true
    identity:
      type: ThirdParty
    manageNetworkPolicy: false
----

.Procedure

. Update the `istio-csr` deployment to include your {SMProduct} 3 control plane by running the following command:

[source,terminal]
----
  helm upgrade cert-manager-istio-csr jetstack/cert-manager-istio-csr \
      --install \
      --reuse-values \
      --namespace istio-system \
      --wait \
      --set "app.istio.revisions={basic,ossm3-v1-24-1}" <1>
----

<1> The `app.istio.revisions` field needs to include your {SMProduct} 3.0 control plane revision _before_ you create your `Istio` resource to ensure that proxies can properly communicate with the {SMProduct} 3.0 control plane.

. Create the `Istio` resource:
+
.Example `Istio` resource
[source,yaml]
----
  apiVersion: sailoperator.io/v1alpha1
  kind: Istio
  metadata:
    name: ossm3
  spec:
    ...
    namespace: istio-system
    values:
      global:
        caAddress: cert-manager-istio-csr.istio-system.svc:443
      pilot:
        env:
          ENABLE_CA_SERVER: "false"
----

Similar to the {SMProduct} 2.6 control plane, these settings disable the built-in CA server and instead use the istio-csr address.