// Module included in the following assemblies:
//
// * service-mesh-docs-main/migrating/cluster-wide/ossm-migrating-cluster-wide-assembly.adoc

:_mod-docs-content-type: ASSEMBLY
[id=ossm-migrating-cluster-wide-assembly]
= Cluster-wide migration guide
include::_attributes/common-attributes.adoc[]
:context: ossm-migrating-cluster-wide-assembly

toc::[]

This guide is for users who are running a cluster-wide deployment of {SMProductName} {SMv2Version} and are migrating to {SMProduct} 3.0.

[IMPORTANT]
====
You must complete the premigration checklists before you start migrating your deployment.
====

include::modules/ossm-control-plane-configuration-migration-requirements.adoc[leveloffset=+1]

[role="_additional-resources"]
.Additional resources

* xref:../../install/ossm-sidecar-injection-assembly.adoc#ossm-about-sidecar-injection_ossm-sidecar-injection-assembly[About sidecar injection]

* xref:../../migrating/checklists/ossm-migrating-network-policies-assembly.adoc#ossm-migrating-network-policies-setup-during-migration_ossm-migrating-network-policies-assembly[Set up network policies to use during migration]

* xref:../../install/ossm-installing-openshift-service-mesh.adoc#ossm-scoping-service-mesh-with-discoveryselectors_ossm-creating-istiocni-resource[Scoping the mesh with discoverySelectors]

include::modules/ossm-cluster-wide-migration-methods.adoc[leveloffset=+1]


// The following tasks are for migration using the Istio revision label

include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-istio-revision-label.adoc[leveloffset=+1]

include::modules/ossm-migrating-workloads-using-the-istio-revision-label.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways-assembly.adoc[Migrating gateways from Service Mesh 2 to Service Mesh 3]

If you are not using gateways, and have verified your cluster-wide migration, you can proceed to complete the migration and remove {SMProduct} 2 resources.

* xref:../../migrating/done/ossm-migrating-complete-assembly.adoc[Completing the Migration]

//The following tasks are for the Istio revision label with cert-manager
include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-istio-revision-label-with-cert-manager.adoc[leveloffset=+1]

include::modules/ossm-migrating-workloads-using-the-istio-revision-label-with-cert-manager.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways-assembly.adoc[Migrating gateways from Service Mesh 2 to Service Mesh 3]

If you are not using gateways, and have verified your cluster-wide migration, you can proceed to complete the migration and remove {SMProduct} 2 resources.

* xref:../../migrating/done/ossm-migrating-complete-assembly.adoc[Completing the Migration]

// The following tasks are for the Istio injection label

include::modules/ossm-migrating-a-cluster-wide-deployment-using-the-istio-injection-label.adoc[leveloffset=+1]

include::modules/ossm-migrating-workloads-using-the-istio-injection-label.adoc[leveloffset=+2]

.Next steps

If you are using gateways, you must migrate them before you complete the migration process.

* xref:../../migrating/migrating-gateways/ossm-migrating-gateways-assembly.adoc[Migrating gateways from Service Mesh 2 to Service Mesh 3]

If you are not using gateways, and have verified your cluster-wide migration, create a default revision tag and re-label namespaces.

include::modules/ossm-creating-a-default-revision-tag-and-relabeling-the-namespaces.adoc[leveloffset=+2]

.Next steps

You can proceed to complete the migration and remove {SMProduct} 2 resources.

* xref:../../migrating/done/ossm-migrating-complete-assembly.adoc[Completing the Migration]

[IMPORTANT]
====
Before creating a default revision tag and relabelling the namespaces, you must migrate all remaining workload namespaces, including gateways.
====

// insert xref to "Creating the default revision tag and relabeling the namespaces" after PR OSSM-9000 is merged

* Creating the default revision tag and relabeling the namespaces
[role="_additional-resources"]
.Additional resources

* xref:../../install/ossm-sidecar-injection-assembly.adoc#ossm-identifying-revision-name_ossm-sidecar-injection-assembly[Identifying the revision name]
